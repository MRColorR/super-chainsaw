<!DOCTYPE html>
<html style="font-size: 16px;" lang="it-IT">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Graph Visualization, graph, big graph, big graph visualization,">
    <meta name="description" content="Questo sito web mostra alcune visualizzazioni dei dati forniti dal progetto di genealogia matematica.">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>3D</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>

    <script src="https://d3js.org/d3.v7.min.js"></script> <!--Caricamento Librerie per la visualizzazione grafo-->
    <script src="//unpkg.com/3d-force-graph"></script>


    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">

    <script type="application/ld+json">
        {
                "@context": "http://schema.org",
                "@type": "Organization",
                "name": "Graph Visualization",
                "logo": "images/679937ce1cb56e0bb03dfa3e58d1b354a622b2756096af69d559356980c8f9b173074db69623916ff544c133905c242c05c68e1eaa4984e2b555ed_1280.png"
        }</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="3D">
    <meta property="og:description" content="Questo sito web mostra alcune visualizzazioni dei dati forniti dal progetto di genealogia matematica.">
    <meta property="og:type" content="website">
</head>
<body class="u-body">
    <header class="u-clearfix u-header u-header" id="sec-1099">
        <div class="u-clearfix u-sheet u-sheet-1">
            <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
                <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
                    <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
                        <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <defs>
                                <symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;">
                                    <rect y="1" width="16" height="2"></rect>
                                    <rect y="7" width="16" height="2"></rect>
                                    <rect y="13" width="16" height="2"></rect>
                                </symbol>
                            </defs>
                        </svg>
                    </a>
                </div>
                <div class="u-custom-menu u-nav-container">
                    <ul class="u-nav u-unstyled u-nav-1">
                        <li class="u-nav-item">
                            <a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="Home.html" style="padding: 10px 20px;">Home</a>
                        </li>
                        <li class="u-nav-item">
                            <a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" style="padding: 10px 20px;">Visualizza in</a><div class="u-nav-popup">
                                <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-2">
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="3D.html">3D</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="2D.html">2D</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="Circular.html">Circular</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="VR.html">VR</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="AR.html">AR</a><div class="u-nav-popup">
                                            <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-3">
                                                <li class="u-nav-item">
                                                    <a class="u-button-style u-nav-link u-white" href="AR-Marker.html">Marker AR</a>
                                                </li>
                                                <li class="u-nav-item">
                                                    <a class="u-button-style u-nav-link u-white" href="AR.html">AR Graph</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="u-custom-menu u-nav-container-collapse">
                    <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
                        <div class="u-inner-container-layout u-sidenav-overflow">
                            <div class="u-menu-close"></div>
                            <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-4">
                                <li class="u-nav-item">
                                    <a class="u-button-style u-nav-link" href="Home.html" style="padding: 10px 20px;">Home</a>
                                </li>
                                <li class="u-nav-item">
                                    <a class="u-button-style u-nav-link" style="padding: 10px 20px;">Visualizza in</a><div class="u-nav-popup">
                                        <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-5">
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="3D.html">3D</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="2D.html">2D</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="Circular.html">Circular</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="VR.html">VR</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="AR.html">AR</a><div class="u-nav-popup">
                                                    <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-6">
                                                        <li class="u-nav-item">
                                                            <a class="u-button-style u-nav-link" href="AR-Marker.html">Marker AR</a>
                                                        </li>
                                                        <li class="u-nav-item">
                                                            <a class="u-button-style u-nav-link" href="AR.html">AR Graph</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
                </div>
            </nav>
            <a href="Home.html" class="u-image u-logo u-image-1" data-image-width="1280" data-image-height="720">
                <img src="images/679937ce1cb56e0bb03dfa3e58d1b354a622b2756096af69d559356980c8f9b173074db69623916ff544c133905c242c05c68e1eaa4984e2b555ed_1280.png" class="u-logo-image u-logo-image-1">
            </a>
        </div>
    </header>
    <form id="select-diameter" onsubmit="event.preventDefault(); changeDiameter2()">
        <label for="diametro">Inserisci un diametro minimo: </label>
        <input type="number" name="diametro" id='diametro'>
        <button type="button" onclick="event.preventDefault(); changeDiameter(this, event)"> Invio </button>
    </form><br />
    <div id="3d-graph"></div> <!--Codice per la visualizzazione 3D e VR del grafo-->

    <script>
        let data = null, graph = null;

        window.onload = () => {
            fetch('./Dataset/Output/graph.json').then(res => res.json()).then(res => {
                data = res;
                drawGraph(data);
            });
        }

        const linearScale = d3.scaleLinear()
            .domain([0, 1200000])
            .range([10, 2000]);

        function drawGraph(graphToDraw, strenght = null) {
            const elem = document.getElementById('3d-graph');
            let i = 0;
            while (elem.firstChild) {
                ++i;
                elem.removeChild(elem.firstChild);
            }
            console.log(`figli eliminati ${i}`);
            graph = ForceGraph3D()(elem)
                .graphData(graphToDraw)
                .nodeAutoColorBy('name')

                .nodeLabel(node => `${node.name}: ${node.discendenti}`)
                .onNodeClick(node => window.open(`Circular.html?id=${node.id}`, '_blank'))
                .onNodeRightClick(node => window.open(`https://it.wikipedia.org/w/index.php?search=${node.name}`, '_blank'))
                .nodeVal(d => { return linearScale(d.discendenti) })
                .linkAutoColorBy('country')
                .linkLabel('country')
                .linkWidth([2])
                .linkOpacity([0.7])
                .linkDirectionalParticles([3])
                .linkDirectionalParticleWidth([4]);
            if (strenght) {
                graph.d3Force('charge', d3.forceManyBody()
                    .strength(-strenght * 8)
                );
                //graph.d3Force('link', d3.forceLink().strenght(strenght * 5)); 
            }
            
        }


        function changeDiameter(button) {
            const diametroMin = button.form.diametro.value;
            let totalNodesDeleted = 0, totalEdgeDeleted = 0; idsRemoved = [];
            newGraph = {
                'nodes': [],
                'links': []
            }

            newGraph.nodes = data.nodes.map(node => {
                if (linearScale(node.discendenti) >= diametroMin)
                    return node;
                totalNodesDeleted += 1;
                idsRemoved.push(node.id);
            }).filter(node => node !== undefined);

            newGraph.links = data.links.map(edge => {
                if (!(idsRemoved.includes(edge.source.id) || idsRemoved.includes(edge.target.id))) {
                    return edge;
                }
                totalEdgeDeleted += 1;
            }).filter(edge => edge !== undefined);

            console.log(`Nodi Eliminati: ${totalNodesDeleted} Archi Eliminati: ${totalEdgeDeleted} `);
            drawGraph(newGraph, diametroMin);
        }

        function changeDiameter2() {
            const diametroMin = document.getElementById("diametro").value;
            console.log(diametroMin);
            let totalNodesDeleted = 0, totalEdgeDeleted = 0; idsRemoved = [];
            newGraph = {
                'nodes': [],
                'links': []
            }

            newGraph.nodes = data.nodes.map(node => {
                if (linearScale(node.discendenti) >= diametroMin)
                    return node;
                totalNodesDeleted += 1;
                idsRemoved.push(node.id);
            }).filter(node => node !== undefined);

            newGraph.links = data.links.map(edge => {
                if (!(idsRemoved.includes(edge.source.id) || idsRemoved.includes(edge.target.id))) {
                    return edge;
                }
                totalEdgeDeleted += 1;
            }).filter(edge => edge !== undefined);

            console.log(`Nodi Eliminati: ${totalNodesDeleted} Archi Eliminati: ${totalEdgeDeleted} `);
            drawGraph(newGraph, diametroMin);
        }

    </script>

    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-02c4">
        <div class="u-clearfix u-sheet u-sheet-1">
            <p class="u-small-text u-text u-text-variant u-text-1"><b>Progetto di Visualizzazione dell'informazione di<br /> Cinti Alessandro, Rapone Ciro, Rengo Mattia</b></p>
        </div>
    </footer>
</body>
</html>