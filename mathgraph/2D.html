<!DOCTYPE html>
<html style="font-size: 16px;" lang="it-IT">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Graph Visualization, graph, big graph, big graph visualization,">
    <meta name="description"
        content="Questo sito web mostra alcune visualizzazioni dei dati forniti dal progetto di genealogia matematica.">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>2D</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>

    <style>
        .menu-contestuale-wrapper {
            position: absolute;
            transform: translate(-50%, 25px);
            font-family: sans-serif;
            font-size: 16px;
            padding: 5px;
            border-radius: 3px;
            color: #eee;
            background: rgba(119, 117, 117, 0.726);
        }

        .menu-contestuale-button {
            margin: 5px;
            display: block;
            color: black;
        }
    </style>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!--Caricamento Librerie per la visualizzazione grafo-->
    <script src="//unpkg.com/force-graph"></script>


    <link id="u-theme-google-font" rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">

    <script type="application/ld+json">
        {
                "@context": "http://schema.org",
                "@type": "Organization",
                "name": "Graph Visualization",
                "logo": "images/679937ce1cb56e0bb03dfa3e58d1b354a622b2756096af69d559356980c8f9b173074db69623916ff544c133905c242c05c68e1eaa4984e2b555ed_1280.png"
        }</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="2D">
    <meta property="og:description"
        content="Questo sito web mostra alcune visualizzazioni dei dati forniti dal progetto di genealogia matematica.">
    <meta property="og:type" content="website">
</head>

<body class="u-body">
    <header class="u-clearfix u-header u-header" id="sec-1099">
        <div class="u-clearfix u-sheet u-sheet-1">
            <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
                <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
                    <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base"
                        href="#">
                        <svg>
                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use>
                        </svg>
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink">
                            <defs>
                                <symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;">
                                    <rect y="1" width="16" height="2"></rect>
                                    <rect y="7" width="16" height="2"></rect>
                                    <rect y="13" width="16" height="2"></rect>
                                </symbol>
                            </defs>
                        </svg>
                    </a>
                </div>
                <div class="u-custom-menu u-nav-container">
                    <ul class="u-nav u-unstyled u-nav-1">
                        <li class="u-nav-item">
                            <a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base"
                                href="Home.html" style="padding: 10px 20px;">Home</a>
                        </li>
                        <li class="u-nav-item">
                            <a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base"
                                style="padding: 10px 20px;">Visualizza in</a>
                            <div class="u-nav-popup">
                                <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-2">
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="3D.html">3D</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="2D.html">2D</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="Circular.html">Circular</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="VR.html">VR</a>
                                    </li>
                                    <li class="u-nav-item">
                                        <a class="u-button-style u-nav-link u-white" href="#">AR</a>
                                        <div class="u-nav-popup">
                                            <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-3">
                                                <li class="u-nav-item">
                                                    <a class="u-button-style u-nav-link u-white"
                                                        href="AR-Marker.html">Marker AR</a>
                                                </li>
                                                <li class="u-nav-item">
                                                    <a class="u-button-style u-nav-link u-white" href="AR.html">AR
                                                        Graph</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="u-custom-menu u-nav-container-collapse">
                    <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
                        <div class="u-inner-container-layout u-sidenav-overflow">
                            <div class="u-menu-close"></div>
                            <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-4">
                                <li class="u-nav-item">
                                    <a class="u-button-style u-nav-link" href="Home.html"
                                        style="padding: 10px 20px;">Home</a>
                                </li>
                                <li class="u-nav-item">
                                    <a class="u-button-style u-nav-link" style="padding: 10px 20px;">Visualizza in</a>
                                    <div class="u-nav-popup">
                                        <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-5">
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="3D.html">3D</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="2D.html">2D</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="Circular.html">Circular</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="VR.html">VR</a>
                                            </li>
                                            <li class="u-nav-item">
                                                <a class="u-button-style u-nav-link" href="#">AR</a>
                                                <div class="u-nav-popup">
                                                    <ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-6">
                                                        <li class="u-nav-item">
                                                            <a class="u-button-style u-nav-link"
                                                                href="AR-Marker.html">Marker AR</a>
                                                        </li>
                                                        <li class="u-nav-item">
                                                            <a class="u-button-style u-nav-link" href="AR.html">AR
                                                                Graph</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
                </div>
            </nav>
            <a href="Home.html" class="u-image u-logo u-image-1" data-image-width="1280" data-image-height="720">
                <img src="images/679937ce1cb56e0bb03dfa3e58d1b354a622b2756096af69d559356980c8f9b173074db69623916ff544c133905c242c05c68e1eaa4984e2b555ed_1280.png"
                    class="u-logo-image u-logo-image-1">
            </a>
        </div>
    </header>
    <form id="select-diameter" onsubmit="event.preventDefault(); changeDiameter()">
        <label for="diametro">Inserisci un diametro minimo: </label>
        <input type="number" name="diametro" id='diametro'>
        <button type="button" onclick="event.preventDefault(); changeDiameter(this,event)"> Invio </button>
    </form><br />
    <div id="graph"></div>
    <!--Codice per la visualizazione 2D-->

    <script>

        let data = null, graph = null;
        //scarico il dataset
        window.onload = () => {
            fetch('./Dataset/Output/graph.json').then(res => res.json()).then(res => {
                data = res;
                drawGraph(data);
            });
        }
        /**
         * Elimina la visualizzazione precedente e ne crea una aggiornata
         * 
         */
        function drawGraph(graphToDraw) {
            console.log("DISEGNO IL GRAFO")
            const elem = document.getElementById('graph').innerHTML = "";
            let i = 0;
            while (elem.firstChild) {
                ++i;
                elem.removeChild(elem.firstChild);
            }
            const linkWidth = 1;
            const forceStrength = -25;
            

            const Graph = ForceGraph()
                (document.getElementById('graph'))
                .width(window.innerWidth)
                .height(window.innerHeight)
                .graphData(graphToDraw)
                .nodeVal(d => { return d.discendenti * 0.5 + 1.3})
                .d3Force('charge', d3.forceManyBody()
                    .strength(forceStrength)
                )
                .d3Force('link', d3.forceLink())
                .nodeId('id')
                .nodeLabel('name')
                .nodeAutoColorBy('name')
                .onNodeClick(node => {
                    console.log(node)
                    //controllo se il menù è gia stato creato
                    if (!document.getElementById("menu-contestuale")) {
                        //Recupero le coordinate del mouse dal div che ha class .graph.tooltip
                        const div = d3.select('.graph-tooltip');
                        const top = div.style('top');
                        const left = div.style('left');

                        const graphWrapper = d3.select('.force-graph-container');
                        //creo un menu-wrapper (div)
                        graphWrapper.append('div')
                            .classed('menu-contestuale-wrapper', true)
                            .attr('id', 'menu-contestuale')
                            .style('top', top)
                            .style('left', left)
                            .on('mouseleave', removeMenu);

                        const menuContestuale = d3.select('#menu-contestuale');
                        //appendo nel documento i bottoni del menu contestuale
                        menuContestuale.append('button')
                            .classed('menu-contestuale-button', true)
                            .text('Visualizzazione Circolare')
                            .attr('type', 'button')
                            .on('click', () => {
                                window.open(`Circular.html?id=${node.id}`, '_blank')
                            })

                        menuContestuale.append('button')
                            .classed('menu-contestuale-button', true)
                            .text('Cerca su Wikipedia    ')
                            .attr('type', 'button')
                            .on('click', () => {
                                window.open(`https://it.wikipedia.org/w/index.php?search=${node.name}`, '_blank')
                            })
                        //console.log(document.getElementsByClassName("menu-contestuale-wrapper").length)
                    }
                })
                .linkLabel('country')
                .linkSource('source')
                .linkTarget('target')
                .linkAutoColorBy('country')
                .linkWidth(linkWidth)
                .linkDirectionalParticles([2])
                .linkDirectionalParticleWidth([2])
                .linkDirectionalParticleColor(["blue"])
                .backgroundColor("black");

                // const canvas = document.getElementsByTagName('canvas')[0]   
                // Graph.d3Force('center', d3.forceCenter(canvas.height/2, canvas.width/2)) //da rivedere forse inutile
            }
            //quando sposto il mouse dal manù contesutale lo elimino dal DOM
            const removeMenu = () => {
                d3.select('.menu-contestuale-wrapper').remove();
            }
            
            /** 
             * Aggiorno il grafo prendendo solo i nodi con il grado specificato
             * (Il diametro di un nodo dipende dal suo grado)
            */
            function changeDiameter(button) {
                let diametroMin = 0;
                if (button) 
                    diametroMin = button.form.diametro.value;
                else
                    diametroMin = document.getElementById("diametro").value;

                let totalNodesDeleted = 0, totalEdgeDeleted = 0; idsRemoved = [];
                newGraph = {
                    'nodes': [],
                    'links': []
                }

                newGraph.nodes = data.nodes.map(node => {
                    if (node.discendenti  >= diametroMin)
                        return node;
                    totalNodesDeleted += 1;
                    idsRemoved.push(node.id);
                }).filter(node => node !== undefined);

                newGraph.links = data.links.map(edge => {
                    if (!(idsRemoved.includes(edge.source.id) || idsRemoved.includes(edge.target.id))) {
                        return edge;
                    }
                    totalEdgeDeleted += 1;
                }).filter(edge => edge !== undefined);

                console.log(`Nodi Eliminati: ${totalNodesDeleted} Archi Eliminati: ${totalEdgeDeleted} `);
                drawGraph(newGraph);
            }

    </script>
    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-02c4">
        <div class="u-clearfix u-sheet u-sheet-1">
            <p class="u-small-text u-text u-text-variant u-text-1"><b>Progetto di Visualizzazione dell'informazione
                    di<br /> Cinti Alessandro, Rapone Ciro, Rengo Mattia</b></p>
        </div>
    </footer>
</body>

</html>